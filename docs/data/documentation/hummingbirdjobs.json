{"seeAlsoSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobsRedis"],"title":"Related Documentation"}],"primaryContentSections":[{"content":[{"type":"heading","anchor":"Overview","text":"Overview","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"A Job consists of some metadata and an execute method to run the job. You can setup HummingbirdJobs to use different drivers for storing job metadata. The module comes with a driver that stores jobs in local memory and uses your current server to process the jobs, but there is also an implementation "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobsRedis"},{"type":"text","text":" that comes with the hummingbird-redis package that stores jobs in a Redis database."}]},{"type":"heading","anchor":"Setting-up-Jobs","text":"Setting up Jobs","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before you can start adding or processing jobs you need to add a jobs driver to the "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdLambda\/HBApplication","isActive":true},{"type":"text","text":". The code below adds a redis driver for jobs. To use a Redis driver you will need to setup Redis first."}]},{"type":"codeListing","syntax":"swift","code":["        let app = HBApplication()","        try app.addRedis(","            configuration: .init(","                hostname: Self.redisHostname,","                port: 6379","            )","        )","        app.addJobs(","            using: .redis(configuration: .init(queueKey: \"_myJobsQueue\")),","            numWorkers: 0","        )"]},{"type":"paragraph","inlineContent":[{"text":"In this example I called ","type":"text"},{"type":"codeVoice","code":"addJob"},{"text":" with ","type":"text"},{"type":"codeVoice","code":"numWorkers"},{"text":" set to ","type":"text"},{"type":"codeVoice","code":"0"},{"text":". This means I can add jobs but they will not be processed. To get another server to process these jobs, I should run a separate version of the app which connects to the same Redis queue but with the ","type":"text"},{"type":"codeVoice","code":"numWorkers"},{"text":" set to the number of threads you want to process the jobs on the queue.","type":"text"}]},{"type":"heading","anchor":"Creating-a-Job","text":"Creating a Job","level":3},{"type":"paragraph","inlineContent":[{"text":"First you must define your job. Create an object that inherits from ","type":"text"},{"code":"HBJob","type":"codeVoice"},{"text":". This protocol requires you to implement a static variable ","type":"text"},{"code":"name","type":"codeVoice"},{"text":" and a function ","type":"text"},{"code":"func execute(on:logger)","type":"codeVoice"},{"text":". The ","type":"text"},{"code":"name","type":"codeVoice"},{"text":" variable should be unique to this job definition. It is used in the serialisation of the job. The ","type":"text"},{"code":"execute","type":"codeVoice"},{"text":" function does the work of the job and returns an ","type":"text"},{"code":"EventLoopFuture","type":"codeVoice"},{"text":" that should be fulfilled when the job is complete. Below is an example of a job that calls a ","type":"text"},{"code":"sendEmail()","type":"codeVoice"},{"text":" function.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["struct SendEmailJob: HBJob {","    static let name = \"SendEmail\"","    let to: String","    let subject: String","    let message: String","    ","    \/\/\/ do the work","    func execute(on eventLoop: EventLoop, logger: Logger) -> EventLoopFuture<Void> {","        return sendEmail(to: self.to, subject: self.subject, message: self.message)","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"Before you can use this job you have to register it.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["SendEmailJob.register()"]},{"type":"paragraph","inlineContent":[{"text":"Now you job is ready to create. Jobs can be queued up using the function ","type":"text"},{"code":"enqueue","type":"codeVoice"},{"text":" on ","type":"text"},{"code":"HBJobQueue","type":"codeVoice"},{"text":". You can access the job queue via ","type":"text"},{"code":"HBApplication.jobs.queue","type":"codeVoice"},{"text":". There is a helper object attached to ","type":"text"},{"code":"HBRequest","type":"codeVoice"},{"text":" that reduces this to ","type":"text"},{"code":"HBRequest.jobs.enqueue","type":"codeVoice"},{"text":".","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let job = SendEmailJob(","    to: \"joe@email.com\",","    subject: \"Testing Jobs\",","    message: \"...\"",")","request.jobs.enqueue(job: job)"]},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"enqueue"},{"type":"text","text":" returns an "},{"type":"codeVoice","code":"EventLoopFuture"},{"type":"text","text":" that will be fulfilled once the job has been added to the queue."}]},{"type":"heading","anchor":"Multiple-Job-Queues","text":"Multiple Job Queues","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"HummingbirdJobs allows for the creation of multiple job queues. To create a new queue you need a new queue id."}]},{"type":"codeListing","syntax":"swift","code":["extension HBJobQueueId {","    static var newQueue: HBJobQueueId { \"newQueue\" }","}"]},{"type":"paragraph","inlineContent":[{"text":"Once you have the new queue id you can register your new queue with this id","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["app.jobs.registerQueue(.newQueue, queue: .redis(configuration: .init(queueKey: \"_myNewJobsQueue\")))"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then when adding jobs you add the queue id to the "},{"code":"enqueue","type":"codeVoice"},{"type":"text","text":" function"}]},{"type":"codeListing","syntax":"swift","code":["request.jobs.enqueue(job: job, queue: .newQueue)"]},{"type":"heading","anchor":"Managing-Job-Queues-outside-HBApplication","text":"Managing Job Queues outside HBApplication","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you prefer you can create your job queue separate from "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdLambda\/HBApplication","isActive":true},{"type":"text","text":". Both the "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBMemoryJobQueue","isActive":true},{"type":"text","text":" and "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobsRedis\/HBRedisJobQueue","isActive":true},{"type":"text","text":" are available. You could set this up as follows."}]},{"type":"codeListing","syntax":"swift","code":["\/\/ setup Redis connection and job queue. This should be the","\/\/ redis connection pool group you use for all your other Redis","\/\/ connections unless you are using a different database","let redisConnectionPoolGroup = try RedisConnectionPoolGroup(","    configuration: .init(hostname: Self.redisHostname, port: 6379),","    eventLoopGroup: app.eventLoopGroup,","    logger: app.logger",")","let jobQueue = HBRedisJobQueue(redisConnectionPoolGroup: redisConnectionPoolGroup)","let jobQueueHandler = HBJobQueueHandler(","    queue: jobQueue, ","    numWorkers: 4, ","    eventLoopGroup: app.eventLoopGroup, ","    logger: app.logger",")","jobQueueHandler.start()","","\/\/ add routes to application","app.put(\"email\") { request -> HTTPResponseStatus in","    let job = SendEmailJob(","        to: \"joe@email.com\",","        subject: \"Testing Jobs\",","        message: \"...\"","    )","    try await jobQueue.enqueue(job: job)","    return .ok","}"]},{"type":"paragraph","inlineContent":[{"text":"If you do setup a job queue as above. You will need to manage the job queue lifecycle and call ","type":"text"},{"code":"jobQueueHandler.shutdown","type":"codeVoice"},{"text":", to shutdown the job queue and its workers, when you shutdown your application.","type":"text"}]}],"kind":"content"}],"metadata":{"modules":[{"name":"HummingbirdJobs"}],"roleHeading":"Framework","role":"collection","externalID":"HummingbirdJobs","title":"HummingbirdJobs","symbolKind":"module"},"topicSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJob","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBAsyncJob","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobContainer"],"title":"Jobs"},{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueue","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueFactory","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueId","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/JobIdentifier","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBQueuedJob","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBMemoryJobQueue"],"title":"Queues"},{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/JobQueueError"],"title":"Error"},{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueHandler"],"title":"Classes"}],"abstract":[{"text":"Offload work your server would be doing to another server.","type":"text"}],"schemaVersion":{"minor":3,"major":0,"patch":0},"hierarchy":{"paths":[[]]},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/hummingbirdjobs"]}],"kind":"symbol","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs"},"sections":[],"references":{"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJobQueueHandler":{"type":"topic","abstract":[{"text":"Object handling a single job queue","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueHandler","kind":"symbol","role":"symbol","title":"HBJobQueueHandler","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBJobQueueHandler"}],"navigatorTitle":[{"kind":"identifier","text":"HBJobQueueHandler"}],"url":"\/documentation\/hummingbirdjobs\/hbjobqueuehandler"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBMemoryJobQueue":{"url":"\/documentation\/hummingbirdjobs\/hbmemoryjobqueue","kind":"symbol","title":"HBMemoryJobQueue","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBMemoryJobQueue"}],"navigatorTitle":[{"kind":"identifier","text":"HBMemoryJobQueue"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBMemoryJobQueue","abstract":[{"type":"text","text":"In memory implementation of job queue driver. Stores jobs in a circular buffer"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobsRedis/HBRedisJobQueue":{"url":"\/documentation\/hummingbirdjobsredis\/hbredisjobqueue","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobsRedis\/HBRedisJobQueue","navigatorTitle":[{"text":"HBRedisJobQueue","kind":"identifier"}],"role":"symbol","title":"HBRedisJobQueue","abstract":[{"text":"Redis implementation of job queues","type":"text"}],"fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBRedisJobQueue","kind":"identifier"}],"kind":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBAsyncJob":{"fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBAsyncJob"}],"abstract":[{"type":"text","text":"Job with asynchronous handler"}],"type":"topic","navigatorTitle":[{"kind":"identifier","text":"HBAsyncJob"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBAsyncJob","url":"\/documentation\/hummingbirdjobs\/hbasyncjob","kind":"symbol","role":"symbol","title":"HBAsyncJob"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJobQueue":{"url":"\/documentation\/hummingbirdjobs\/hbjobqueue","kind":"symbol","title":"HBJobQueue","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBJobQueue"}],"navigatorTitle":[{"kind":"identifier","text":"HBJobQueue"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueue","abstract":[{"type":"text","text":"Job queue protocol."}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/JobIdentifier":{"url":"\/documentation\/hummingbirdjobs\/jobidentifier","kind":"symbol","title":"JobIdentifier","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"JobIdentifier"}],"navigatorTitle":[{"kind":"identifier","text":"JobIdentifier"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/JobIdentifier","abstract":[{"type":"text","text":"Identifier for Job"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJobContainer":{"fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"HBJobContainer","kind":"identifier"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobContainer","title":"HBJobContainer","navigatorTitle":[{"text":"HBJobContainer","kind":"identifier"}],"abstract":[{"text":"Holder for all data related to a job","type":"text"}],"type":"topic","url":"\/documentation\/hummingbirdjobs\/hbjobcontainer","role":"symbol","kind":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird":{"abstract":[{"type":"text","text":"Lightweight, flexible server framework written in Swift."}],"title":"Hummingbird","role":"collection","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird","kind":"symbol","url":"\/documentation\/hummingbird"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/JobQueueError":{"kind":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"JobQueueError","kind":"identifier"}],"url":"\/documentation\/hummingbirdjobs\/jobqueueerror","type":"topic","title":"JobQueueError","navigatorTitle":[{"text":"JobQueueError","kind":"identifier"}],"abstract":[{"type":"text","text":"Job Queue Error type"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/JobQueueError","role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobsRedis":{"title":"HummingbirdJobsRedis","type":"topic","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobsRedis","role":"collection","abstract":[],"url":"\/documentation\/hummingbirdjobsredis"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs":{"url":"\/documentation\/hummingbirdjobs","kind":"symbol","title":"HummingbirdJobs","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs","abstract":[{"type":"text","text":"Offload work your server would be doing to another server."}],"role":"collection"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJobQueueFactory":{"url":"\/documentation\/hummingbirdjobs\/hbjobqueuefactory","kind":"symbol","title":"HBJobQueueFactory","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBJobQueueFactory"}],"navigatorTitle":[{"kind":"identifier","text":"HBJobQueueFactory"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueFactory","abstract":[{"type":"text","text":"Factory class for Job Queue drivers"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBQueuedJob":{"url":"\/documentation\/hummingbirdjobs\/hbqueuedjob","kind":"symbol","title":"HBQueuedJob","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBQueuedJob"}],"navigatorTitle":[{"kind":"identifier","text":"HBQueuedJob"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBQueuedJob","abstract":[{"type":"text","text":"Queued job. Includes job, plus the id for the job"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJobQueueId":{"url":"\/documentation\/hummingbirdjobs\/hbjobqueueid","kind":"symbol","title":"HBJobQueueId","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBJobQueueId"}],"navigatorTitle":[{"kind":"identifier","text":"HBJobQueueId"}],"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJobQueueId","abstract":[{"type":"text","text":"Job queue id"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdLambda/HBApplication":{"type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdLambda\/HBApplication","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBApplication"}],"abstract":[{"type":"text","text":"Application class. Brings together all the components of Hummingbird together"}],"navigatorTitle":[{"kind":"identifier","text":"HBApplication"}],"title":"HBApplication","kind":"symbol","role":"symbol","url":"\/documentation\/hummingbirdlambda\/hbapplication"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdJobs/HBJob":{"title":"HBJob","type":"topic","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdJobs\/HBJob","navigatorTitle":[{"text":"HBJob","kind":"identifier"}],"role":"symbol","abstract":[{"text":"Protocol for job description","type":"text"}],"url":"\/documentation\/hummingbirdjobs\/hbjob","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBJob","kind":"identifier"}]}}}