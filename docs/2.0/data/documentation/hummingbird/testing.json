{"sections":[],"schemaVersion":{"patch":0,"minor":3,"major":0},"metadata":{"title":"Testing","roleHeading":"Article","modules":[{"name":"Hummingbird"},{"name":"HummingbirdXCT"}],"role":"article"},"kind":"article","identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Testing","interfaceLanguage":"swift"},"seeAlsoSections":[{"title":"Guides","generated":true,"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Router","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/EncodingAndDecoding","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LoggingMetricsAndTracing","doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData"]}],"abstract":[{"text":"Using the HummingbirdXCT framework to test your application","type":"text"}],"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird"],["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdXCT"],["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"text":"Writing tests for application APIs is an important part of the development process. They ensure everything works as you expected and that you don’t break functionality with future changes. Hummingbird provides a framework for testing your application as if it is a running server and you are a client connecting to it.","type":"text"}]},{"type":"heading","level":2,"anchor":"Example","text":"Example"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Lets create a simple application that says hello back to you. ie If your request is to "},{"type":"codeVoice","code":"\/hello\/adam"},{"type":"text","text":" it returns “Hello adam!”."}]},{"type":"codeListing","syntax":"swift","code":["let router = HBRouter()","router.get(\"hello\/{name}\") { _,context in","    return try \"Hello \\(context.parameters.require(\"name\"))!\"","}","let app = HBApplication(router: router)"]},{"type":"heading","level":2,"anchor":"Testing","text":"Testing"},{"type":"paragraph","inlineContent":[{"text":"We can test the application returns the correct text as follows","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["func testApplicationReturnsCorrectText() async throw {","    try await app.test(.router) { client in","        try await client.XCTExecute(","            uri: \"\/hello\/john\",","            method: .get,","            headers: [:],  \/\/ default value","            body: nil      \/\/ default value","        ) { response in","            XCTAssertEqual(response.status, .ok)","            let body = try XCTUnwrap(response.body)","            XCTAssertEqual(String(buffer: body), \"Hello john!\")","        }","    }","}"]},{"type":"heading","level":3,"anchor":"HBApplicationtest","text":"`HBApplication.test`"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/HBApplicationProtocol\/test(_:_:)","isActive":true},{"type":"text","text":" function takes two parameters, first the test framework to use and then the closure to run with the framework client. The test framework defines how we are going to test our application. There are three possible frameworks"}]},{"type":"heading","level":4,"anchor":"Router-router","text":"Router (.router)"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The router test framework will send requests directly to the router. It does not need a running server to run tests. The main advantages of this is it is the quickest way to test your application but will not test anything outside of the router. In most cases you won’t need more than this."}]},{"type":"heading","level":4,"anchor":"Live-live","text":"Live (.live)"},{"type":"paragraph","inlineContent":[{"text":"The live framework uses a live server, with an HTTP client attached on a single connection.","type":"text"}]},{"type":"heading","level":4,"anchor":"AsyncHTTPClient-ahc","text":"AsyncHTTPClient (.ahc)"},{"type":"paragraph","inlineContent":[{"text":"The AsyncHTTPClient framework is the same as the live framework except it uses ","type":"text"},{"identifier":"https:\/\/github.com\/swift-server\/async-http-client","isActive":true,"type":"reference"},{"text":" from swift-server as its HTTPClient. You can use this to test TLS and HTTP2 connections.","type":"text"}]},{"type":"heading","level":3,"anchor":"Executing-requests-and-testing-the-response","text":"Executing requests and testing the response"},{"type":"paragraph","inlineContent":[{"text":"The function ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdXCT\/HBXCTClientProtocol\/XCTExecute(uri:method:headers:body:testCallback:)"},{"text":" sends a request to your application and provides the response in a closure. If you return something from the closure then this is returned by ","type":"text"},{"type":"codeVoice","code":"XCTExecute"},{"text":". In the following example we are testing whether a session cookie works.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["func testApplicationReturnsCorrectText() async throw {","    try await app.test(.router) { client in","        \/\/ test login, returns a set-cookie header and extract","        let cookie = try await client.XCTExecute(","            uri: \"\/user\/login\", ","            method: .post, ","            headers: [.authorization: \"Basic blahblah\"]","        ) { response in","            XCTAssertEqual(response.status, .ok)","            return try XCTUnwrap(response.headers[.setCookie])","        }","        \/\/ check session cookie works","        try await client.XCTExecute(","            uri: \"\/user\/is-authenticated\", ","            method: .get, ","            headers: [.cookie: cookie]","        ) { response in","            XCTAssertEqual(response.status, .ok)","        }","    }","}"]}]}],"references":{"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ErrorHandling":{"title":"Error Handling","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ErrorHandling","kind":"article","type":"topic","role":"collectionGroup","url":"\/documentation\/hummingbird\/errorhandling","abstract":[{"type":"text","text":"How to build errors for the server to return."}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/EncodingAndDecoding":{"abstract":[{"text":"Hummingbird uses ","type":"text"},{"code":"Codable","type":"codeVoice"},{"text":" to decode requests and encode responses.","type":"text"}],"url":"\/documentation\/hummingbird\/encodinganddecoding","title":"Encoding and Decoding","role":"collectionGroup","kind":"article","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/EncodingAndDecoding"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird":{"role":"collection","kind":"symbol","type":"topic","abstract":[{"text":"Lightweight, modern, flexible server framework written in Swift.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird","url":"\/documentation\/hummingbird","title":"Hummingbird"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/RequestContexts":{"role":"collectionGroup","kind":"article","type":"topic","abstract":[{"text":"Controlling contextual data provided to middleware and route handlers","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/RequestContexts","url":"\/documentation\/hummingbird\/requestcontexts","title":"Request Contexts"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/MigratingToV2":{"role":"article","url":"\/documentation\/hummingbird\/migratingtov2","kind":"article","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/MigratingToV2","title":"Migrating to Hummingbird v2","abstract":[{"text":"Migration guide for converting Hummingbird v1 applications to Hummingbird v2","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/LoggingMetricsAndTracing":{"role":"collectionGroup","url":"\/documentation\/hummingbird\/loggingmetricsandtracing","title":"Logging, Metrics and Tracing","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/LoggingMetricsAndTracing","type":"topic","abstract":[{"type":"text","text":"Considered the three pillars of observability, logging, metrics and tracing provide different ways of viewing how your application is working."}],"kind":"article"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdXCT/HBXCTClientProtocol/XCTExecute(uri:method:headers:body:testCallback:)":{"fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"XCTExecute","kind":"identifier"},{"text":"<","kind":"text"},{"text":"Return","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"uri","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"String","preciseIdentifier":"s:SS","kind":"typeIdentifier"},{"text":", ","kind":"text"},{"text":"method","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"HTTPRequest","preciseIdentifier":"s:9HTTPTypes11HTTPRequestV","kind":"typeIdentifier"},{"text":".","kind":"text"},{"text":"Method","preciseIdentifier":"s:9HTTPTypes11HTTPRequestV6MethodV","kind":"typeIdentifier"},{"text":", ","kind":"text"},{"text":"headers","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"HTTPFields","preciseIdentifier":"s:9HTTPTypes10HTTPFieldsV","kind":"typeIdentifier"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"body"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"ByteBuffer","preciseIdentifier":"s:7NIOCore10ByteBufferV"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"testCallback"},{"kind":"text","text":": ("},{"kind":"typeIdentifier","text":"HBXCTResponse","preciseIdentifier":"s:14HummingbirdXCT13HBXCTResponseV"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"Return","preciseIdentifier":"s:14HummingbirdXCT19HBXCTClientProtocolPAAE10XCTExecute3uri6method7headers4body12testCallbackqd__SS_9HTTPTypes11HTTPRequestV6MethodVAJ10HTTPFieldsV7NIOCore10ByteBufferVSgqd__AA13HBXCTResponseVYaKctYaKlF6ReturnL_qd__mfp"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"Return","preciseIdentifier":"s:14HummingbirdXCT19HBXCTClientProtocolPAAE10XCTExecute3uri6method7headers4body12testCallbackqd__SS_9HTTPTypes11HTTPRequestV6MethodVAJ10HTTPFieldsV7NIOCore10ByteBufferVSgqd__AA13HBXCTResponseVYaKctYaKlF6ReturnL_qd__mfp"}],"url":"\/documentation\/hummingbirdxct\/hbxctclientprotocol\/xctexecute(uri:method:headers:body:testcallback:)","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdXCT\/HBXCTClientProtocol\/XCTExecute(uri:method:headers:body:testCallback:)","role":"symbol","type":"topic","abstract":[{"text":"Send request to associated test framework and call test callback on the response returned","type":"text"}],"title":"XCTExecute(uri:method:headers:body:testCallback:)"},"doc://com.opticalaberration.hummingbird/documentation/index":{"role":"collection","kind":"article","type":"topic","abstract":[{"text":"Lightweight, flexible, modern server framework written in Swift.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index","url":"\/documentation\/index","title":"Hummingbird"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/Router":{"role":"collectionGroup","kind":"article","type":"topic","abstract":[{"text":"The router directs requests to their handlers based on the contents of their path.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Router","url":"\/documentation\/hummingbird\/router","title":"Router"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdXCT":{"role":"collection","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdXCT","url":"\/documentation\/hummingbirdxct","type":"topic","title":"HummingbirdXCT","abstract":[{"text":"Test framework for Hummingbird","type":"text"}]},"https://github.com/swift-server/async-http-client":{"url":"https:\/\/github.com\/swift-server\/async-http-client","identifier":"https:\/\/github.com\/swift-server\/async-http-client","titleInlineContent":[{"text":"AsyncHTTPClient","type":"text"}],"type":"link","title":"AsyncHTTPClient"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/HBApplicationProtocol/test(_:_:)":{"kind":"symbol","title":"test(_:_:)","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/HBApplicationProtocol\/test(_:_:)","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"test","kind":"identifier"},{"text":"<","kind":"text"},{"text":"Value","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"XCTTestingSetup","preciseIdentifier":"s:14HummingbirdXCT15XCTTestingSetupV","kind":"typeIdentifier"},{"text":", (","kind":"text"},{"text":"any","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBXCTClientProtocol","preciseIdentifier":"s:14HummingbirdXCT19HBXCTClientProtocolP","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:11Hummingbird21HBApplicationProtocolP0A3XCTE4testyqd__AD15XCTTestingSetupV_qd__AD011HBXCTClientC0_pYaYbKctYaKlF5ValueL_qd__mfp","text":"Value","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:11Hummingbird21HBApplicationProtocolP0A3XCTE4testyqd__AD15XCTTestingSetupV_qd__AD011HBXCTClientC0_pYaYbKctYaKlF5ValueL_qd__mfp","text":"Value","kind":"typeIdentifier"}],"url":"\/documentation\/hummingbird\/hbapplicationprotocol\/test(_:_:)","abstract":[{"text":"Test ","type":"text"},{"code":"HBApplication","type":"codeVoice"}],"role":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/PersistentData":{"role":"collectionGroup","type":"topic","title":"Persistent data","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/PersistentData","kind":"article","abstract":[{"type":"text","text":"How to persist data between requests to your server."}],"url":"\/documentation\/hummingbird\/persistentdata"}}}