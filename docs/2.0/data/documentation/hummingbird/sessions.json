{"sections":[],"kind":"article","topicSections":[{"anchor":"Reference","title":"Reference","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionAuthenticator","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionMiddleware"]}],"abstract":[{"type":"text","text":"Session based authentication"}],"primaryContentSections":[{"kind":"content","content":[{"anchor":"overview","text":"Overview","type":"heading","level":2},{"inlineContent":[{"text":"Sessions allow you to persist user authentication data between multiple requests to the server. They work by creating a temporary session object that is stored in a key\/value store. The key or session id is returned in the response. Subsequent requests can then access the session object by supplying the session id in their request. This object can then be used to authenicate the user. Normally the session id is stored in a cookie.","type":"text"}],"type":"paragraph"},{"type":"heading","level":2,"text":"SessionMiddleware","anchor":"SessionMiddleware"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionMiddleware","type":"reference"},{"text":" is used to extract and save session state from the RequestContext. To use it your ","type":"text"},{"type":"codeVoice","code":"RequestContext"},{"text":" must conform to ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext","isActive":true,"type":"reference"},{"text":". Adding the ","type":"text"},{"type":"codeVoice","code":"SessionMiddleware"},{"text":" to your middleware stack will mean any middleware or routes after will have read\/write access to session state via the member ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext\/sessions","isActive":true,"type":"reference"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"SessionMiddleware"},{"text":" needs a persist key value store to save its state. You can find out more about the persist framework here <doc: PersistentData>. In the example below we are using an in memory key value store, but ","type":"text"},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFluent\/FluentPersistDriver","isActive":true},{"type":"text","text":" and "},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdRedis\/RedisPersistDriver","type":"reference","isActive":true},{"type":"text","text":" provide solutions that stores the session data in a database or redis database respectively."}]},{"code":["router.add(","    middleware: SessionMiddleware(","        storage: MemoryPersistDriver()","    )",")"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default sessions store the session id in a "},{"type":"codeVoice","code":"SESSION_ID"},{"text":" cookie and the default session expiration is 12 hours. At initialization it is possible to set these up differently.","type":"text"}]},{"type":"codeListing","code":["router.add(","    middleware: SessionMiddleware(","        storage: MemoryPersistDriver(),","        sessionCookie: \"MY_SESSION_ID\",","        defaultSessionExpiration: .seconds(60 * 60)","    )",")"],"syntax":"swift"},{"anchor":"SessionRequestContext","text":"SessionRequestContext","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext","isActive":true,"type":"reference"},{"type":"text","text":" protocol requires you include a member "},{"type":"codeVoice","code":"sessions"},{"type":"text","text":". This is a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionContext"},{"type":"text","text":" type which includes a generic parameter defining what your session object is."}]},{"type":"codeListing","syntax":"swift","code":["struct MyRequestContext: SessionRequestContext {","    \/\/\/ core context","    public var coreContext: CoreRequestContextStorage","    \/\/\/ session context with UUID as the session object","    public let sessions: SessionContext<UUID>","}"]},{"type":"heading","text":"Saving a session","level":2,"anchor":"Saving-a-session"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once a user is authenticated you need to save a session for the user."}]},{"syntax":"swift","code":["func login(_ request: Request, context: MyRequestContext) async throws -> HTTPResponseStatus {","    \/\/ get authenticated user","    let user = try context.requireIdentity()","    \/\/ create session lasting 1 hour","    context.sessions.setSession(user.id, expiresIn: .seconds(600))","    return .ok","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In this example "},{"type":"codeVoice","code":"user.id"},{"type":"text","text":" is saved with the session id. The data we save in "},{"code":"setSession","type":"codeVoice"},{"type":"text","text":" is saved to storage when we return to the "},{"type":"codeVoice","code":"SessionMiddleware"},{"text":". If your route throws an error then the session data is not updated.","type":"text"}]},{"text":"Sessions Authentication","anchor":"Sessions-Authentication","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"To authenticate a user using a session id you need to add a "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionAuthenticator"},{"text":" middleware to the router. This uses the session stored in the request context and converts it into the authenticated user using the closure or ","type":"text"},{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/UserSessionRepository","isActive":true,"type":"reference"},{"text":" provided. The session authenticator requires your ","type":"text"},{"code":"RequestContext","type":"codeVoice"},{"text":" conforms to both ","type":"text"},{"type":"codeVoice","code":"SessionRequestContext"},{"text":" and ","type":"text"},{"code":"AuthRequestContext","type":"codeVoice"},{"type":"text","text":"."}]},{"type":"codeListing","syntax":"swift","code":["router.addMiddleware {","    SessionMiddleware(storage: MemoryPersistDriver())","    SessionAuthenticator { session, context in","        try await getUser(from: session)","    }","}","router.get(\"session\") { request, context -> HTTPResponse.Status in","    _ = try context.requireIdentity()","    return .ok","}"]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"seeAlsoSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/AuthenticatorMiddleware"],"generated":true,"anchor":"Articles","title":"Articles"}],"identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/Sessions","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth"],["doc:\/\/com.opticalaberration.hummingbird\/documentation\/index"]]},"metadata":{"title":"Sessions","roleHeading":"API Collection","role":"collectionGroup","images":[{"identifier":"logo.png","type":"icon"}],"modules":[{"name":"HummingbirdAuth"}]},"references":{"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/UserSessionRepository":{"url":"\/documentation\/hummingbirdauth\/usersessionrepository","kind":"symbol","role":"symbol","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"UserSessionRepository","kind":"identifier"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/UserSessionRepository","abstract":[{"type":"text","text":"Repository of users identified by a session object"}],"type":"topic","navigatorTitle":[{"text":"UserSessionRepository","kind":"identifier"}],"title":"UserSessionRepository"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/AuthenticatorMiddleware":{"url":"\/documentation\/hummingbird\/authenticatormiddleware","role":"collectionGroup","images":[{"type":"icon","identifier":"logo.png"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/AuthenticatorMiddleware","title":"Authenticator Middleware","type":"topic","abstract":[{"type":"text","text":"Request authentication middleware"}],"kind":"article"},"logo.png":{"identifier":"logo.png","alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/com.opticalaberration.hummingbird\/logo.png"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFluent/FluentPersistDriver":{"role":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"FluentPersistDriver"}],"kind":"symbol","url":"\/documentation\/hummingbirdfluent\/fluentpersistdriver","navigatorTitle":[{"text":"FluentPersistDriver","kind":"identifier"}],"type":"topic","title":"FluentPersistDriver","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFluent\/FluentPersistDriver","abstract":[{"type":"text","text":"Fluent driver for persist system for storing persistent cross request key\/value pairs"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/SessionMiddleware":{"type":"topic","title":"SessionMiddleware","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionMiddleware","url":"\/documentation\/hummingbirdauth\/sessionmiddleware","kind":"symbol","abstract":[{"text":"Middleware that extracts session data for a request and stores it in the context","type":"text"}],"role":"symbol","navigatorTitle":[{"text":"SessionMiddleware","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SessionMiddleware","kind":"identifier"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/SessionAuthenticator":{"type":"topic","title":"SessionAuthenticator","role":"symbol","kind":"symbol","navigatorTitle":[{"text":"SessionAuthenticator","kind":"identifier"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionAuthenticator","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"SessionAuthenticator","kind":"identifier"}],"abstract":[{"type":"text","text":"Session authenticator"}],"url":"\/documentation\/hummingbirdauth\/sessionauthenticator"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth":{"role":"collection","abstract":[{"text":"Authentication framework and extensions for Hummingbird.","type":"text"}],"url":"\/documentation\/hummingbirdauth","type":"topic","kind":"symbol","title":"HummingbirdAuth","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth","images":[{"type":"icon","identifier":"logo.png"}]},"doc://com.opticalaberration.hummingbird/documentation/index":{"role":"collection","abstract":[{"text":"Lightweight, flexible, modern server framework written in Swift.","type":"text"}],"url":"\/documentation\/index","kind":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/index","title":"Hummingbird","type":"topic","images":[{"type":"icon","identifier":"logo.png"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/SessionRequestContext":{"navigatorTitle":[{"text":"SessionRequestContext","kind":"identifier"}],"title":"SessionRequestContext","url":"\/documentation\/hummingbirdauth\/sessionrequestcontext","role":"symbol","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"SessionRequestContext"}],"kind":"symbol","abstract":[{"type":"text","text":"Protocol for RequestContext that stores session data"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/SessionContext":{"url":"\/documentation\/hummingbirdauth\/sessioncontext","role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionContext","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SessionContext","kind":"identifier"}],"title":"SessionContext","navigatorTitle":[{"text":"SessionContext","kind":"identifier"}],"type":"topic","abstract":[{"text":"Session context","type":"text"}],"kind":"symbol"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/SessionRequestContext/sessions":{"abstract":[],"type":"topic","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/SessionRequestContext\/sessions","url":"\/documentation\/hummingbirdauth\/sessionrequestcontext\/sessions","role":"symbol","fragments":[{"kind":"keyword","text":"var"},{"text":" ","kind":"text"},{"kind":"identifier","text":"sessions"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:15HummingbirdAuth14SessionContextV","text":"SessionContext"},{"text":"<","kind":"text"},{"text":"Session","kind":"typeIdentifier","preciseIdentifier":"s:15HummingbirdAuth21SessionRequestContextP0C0Qa"},{"kind":"text","text":">"}],"title":"sessions","required":true},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdRedis/RedisPersistDriver":{"type":"topic","title":"RedisPersistDriver","url":"\/documentation\/hummingbirdredis\/redispersistdriver","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"RedisPersistDriver"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdRedis\/RedisPersistDriver","kind":"symbol","abstract":[{"type":"text","text":"Redis driver for persist system for storing persistent cross request key\/value pairs"}],"role":"symbol","navigatorTitle":[{"kind":"identifier","text":"RedisPersistDriver"}]}}}