{"kind":"project","metadata":{"title":"Testing your application","role":"project","category":"Todo backend","categoryPathComponent":"Todos"},"schemaVersion":{"major":0,"minor":3,"patch":0},"hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos","doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/$volume","doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application"]],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos","modules":[{"projects":[{"sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Template#Create-your-project","kind":"task"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Template"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Application-setup"},{"projects":[{"sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Todo-Controller-and-Repository","kind":"task"},{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Testing-your-application-with-curl","kind":"task"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/API-Setup"},{"projects":[{"sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Project-testing-setup","kind":"task"},{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Test-your-application","kind":"task"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application"},{"projects":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres","sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-your-Postgres-database","kind":"task"},{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-a-Postgres-repository","kind":"task"}]}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Store-Todos-in-a-database"}]},"variants":[{"paths":["\/tutorials\/hummingbird\/todos-3-testing"],"traits":[{"interfaceLanguage":"swift"}]}],"sections":[{"kind":"hero","title":"Testing your application","image":"hummingbird.png","backgroundImage":"hummingbird.png","chapter":"Testing your application","content":[{"type":"paragraph","inlineContent":[{"text":"Test your application using the HummingbirdTesting framework","type":"text"}]}],"estimatedTimeInMinutes":15},{"kind":"tasks","tasks":[{"anchor":"Project-testing-setup","title":"Project testing setup","contentSection":[{"kind":"contentAndMedia","media":"hummingbird.png","mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"text":"Review application testing setup from template.","type":"text"}]}]}],"stepsSection":[{"media":null,"runtimePreview":null,"content":[{"inlineContent":[{"text":"Open Package.swift","type":"text"}],"type":"paragraph"}],"caption":[{"inlineContent":[{"text":"You see at the bottom there is a test target call ","type":"text"},{"code":"AppTests","type":"codeVoice"},{"text":". It is dependent on the target ","type":"text"},{"code":"App","type":"codeVoice"},{"text":" and the library ","type":"text"},{"code":"HummingbirdTesting","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"}],"type":"step","code":"todos-testing-01.swift"},{"media":null,"runtimePreview":null,"content":[{"inlineContent":[{"text":"Open Tests\/AppTests\/AppTests.swift","type":"text"}],"type":"paragraph"}],"caption":[{"inlineContent":[{"type":"text","text":"It contains one test, "},{"type":"codeVoice","code":"testApp()"},{"type":"text","text":". This creates a copy of the Application using "},{"type":"codeVoice","code":"buildApplication(_:)"},{"type":"text","text":" and uses the Hummingbird test framework to verify the GET "},{"type":"codeVoice","code":"\/health"},{"type":"text","text":" endpoint returns a 200 (Ok) response."}],"type":"paragraph"}],"type":"step","code":"todos-testing-02.swift"},{"media":null,"runtimePreview":null,"content":[{"inlineContent":[{"text":"We cannot create an instance of ","type":"text"},{"type":"codeVoice","code":"App"},{"text":", so need another way of passing the arguments to the ","type":"text"},{"code":"buildApplication","type":"codeVoice"},{"text":" function in our tests. So ","type":"text"},{"code":"buildApplication(_:)","type":"codeVoice"},{"text":" doesn’t take ","type":"text"},{"code":"App","type":"codeVoice"},{"text":" as a parameter. Instead its parameter is a type that conforms to the protocol ","type":"text"},{"code":"AppArguments","type":"codeVoice"},{"text":" which includes the parameters the function needs. We then conform ","type":"text"},{"code":"App","type":"codeVoice"},{"text":" to  ","type":"text"},{"code":"AppArguments","type":"codeVoice"},{"text":" and in our tests create a new type ","type":"text"},{"code":"TestArguments","type":"codeVoice"},{"text":" which conforms to the protocol ","type":"text"},{"code":"AppArguments","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"}],"caption":[],"type":"step","code":"todos-testing-03.swift"}]},{"anchor":"Test-your-application","title":"Test your application","contentSection":[{"kind":"contentAndMedia","mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"text":"Writing Tests to ensure you application API works.","type":"text"}]}],"media":"hummingbird.png"}],"stepsSection":[{"runtimePreview":null,"type":"step","caption":[{"inlineContent":[{"type":"text","text":"In the closure passed to "},{"type":"codeVoice","code":"test"},{"type":"text","text":" you are provided with a client to interact with the current test framework. With this you can send requests and verify the contents of their responses."}],"type":"paragraph"}],"code":"todos-testing-08.swift","content":[{"inlineContent":[{"type":"text","text":"Lets replace the "},{"code":"testApp","type":"codeVoice"},{"type":"text","text":" function with a test for the create todo function. Application testing is done with the function "},{"isActive":true,"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ApplicationProtocol\/test(_:_:)"},{"type":"text","text":". The first parameter indicates what test framework you want to use. Here we are using "},{"code":".router","type":"codeVoice"},{"type":"text","text":" which sends our request directly to the router without a live server process."}],"type":"paragraph"}],"media":null},{"runtimePreview":null,"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"Now the create test has been simplified to two lines of code. Call create function, test return value.","type":"text"}]}],"code":"todos-testing-09.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Writing the whole execute line out each time and converting the responses to something readable can become tiresome. So lets break out the create API call to a separate function. You’ll notice in this function we return the decoded "},{"type":"codeVoice","code":"Todo"},{"type":"text","text":" from the execute closure."}]}],"media":null},{"runtimePreview":null,"type":"step","caption":[],"code":"todos-testing-10.swift","content":[{"inlineContent":[{"text":"In actual fact lets create helper functions for all the API calls. With these it shoud be a lot easier to write tests","type":"text"}],"type":"paragraph"}],"media":null},{"runtimePreview":null,"type":"step","caption":[],"code":"todos-testing-11.swift","content":[{"type":"paragraph","inlineContent":[{"text":"We can now create more complex test functions. This one edits a todo twice and verifies the edits have been stored.","type":"text"}]}],"media":null},{"runtimePreview":null,"type":"step","caption":[],"code":"todos-testing-12.swift","content":[{"type":"paragraph","inlineContent":[{"text":"The following is the equivalent of the list of curl commands we wrote in the previous chapter to test everything was working ok. Its not the most sensible test but it demonstrates how much easier it is test your application using HummingbirdTesting.","type":"text"}]}],"media":null},{"runtimePreview":null,"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"Hint: A couple of these require you to use execute directly instead of calling the helper functions we wrote at the top.","type":"text"}]}],"code":"todos-testing-13.swift","content":[{"type":"paragraph","inlineContent":[{"text":"Here are some tests that haven’t been written yet. Maybe you could complete them for me.","type":"text"}]}],"media":null}]}]},{"kind":"callToAction","action":{"isActive":true,"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres","type":"reference","overridingTitleInlineContent":[{"text":"Get started","type":"text"}],"overridingTitle":"Get started"},"title":"Use PostgresNIO to store your Todos in a Postgres database","featuredEyebrow":"Tutorial","abstract":[{"text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO.","type":"text"}]}],"identifier":{"url":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing","interfaceLanguage":"swift"},"references":{"doc://com.opticalaberration.hummingbird/tutorials/Todos/API-Setup":{"type":"topic","kind":"article","role":"article","url":"\/tutorials\/todos\/api-setup","title":"API Setup","abstract":[],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/API-Setup"},"todos-testing-02.swift":{"fileName":"Tests\/AppTests\/AppTests.swift","highlights":[],"fileType":"swift","type":"file","syntax":"swift","identifier":"todos-testing-02.swift","content":["import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","final class AppTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 0","        let logLevel: Logger.Level? = .trace","    }","","    func testApp() async throws {","        let args = TestArguments()","        let app = try await buildApplication(args)","        try await app.test(.router) { client in","            try await client.execute(uri: \"\/health\", method: .get) { response in","                XCTAssertEqual(response.status, .ok)","            }","        }","    }","}"]},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres":{"type":"topic","kind":"project","estimatedTime":"15min","role":"project","url":"\/tutorials\/hummingbird\/todos-4-postgres","title":"Use PostgresNIO to store your Todos in a Postgres database","abstract":[{"type":"text","text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO."}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-1-Template#Create-your-project":{"type":"section","kind":"section","role":"pseudoSymbol","url":"\/tutorials\/hummingbird\/todos-1-template#Create-your-project","title":"Create your project","abstract":[{"text":"Create a simple web application using the Hummingbird template.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Template#Create-your-project"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres#Setup-your-Postgres-database":{"type":"section","kind":"section","role":"pseudoSymbol","url":"\/tutorials\/hummingbird\/todos-4-postgres#Setup-your-Postgres-database","title":"Setup your Postgres database","abstract":[{"type":"text","text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO."}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-your-Postgres-database"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/ApplicationProtocol/test(_:_:)":{"url":"\/documentation\/hummingbird\/applicationprotocol\/test(_:_:)","kind":"symbol","abstract":[{"type":"text","text":"Test "},{"type":"codeVoice","code":"Application"}],"fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"test","kind":"identifier"},{"text":"<","kind":"text"},{"text":"Value","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"TestingSetup","kind":"typeIdentifier","preciseIdentifier":"s:18HummingbirdTesting0B5SetupV"},{"text":", (","kind":"text"},{"text":"any","kind":"keyword"},{"text":" ","kind":"text"},{"text":"TestClientProtocol","kind":"typeIdentifier","preciseIdentifier":"s:18HummingbirdTesting18TestClientProtocolP"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"Value","kind":"typeIdentifier","preciseIdentifier":"s:11Hummingbird19ApplicationProtocolP0A7TestingE4testyqd__AD0D5SetupV_qd__AD010TestClientC0_pYaYbKctYaKlF5ValueL_qd__mfp"},{"text":") ","kind":"text"},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"Value","preciseIdentifier":"s:11Hummingbird19ApplicationProtocolP0A7TestingE4testyqd__AD0D5SetupV_qd__AD010TestClientC0_pYaYbKctYaKlF5ValueL_qd__mfp"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/ApplicationProtocol\/test(_:_:)","type":"topic","title":"test(_:_:)","role":"symbol"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres#Setup-a-Postgres-repository":{"type":"section","kind":"section","role":"pseudoSymbol","url":"\/tutorials\/hummingbird\/todos-4-postgres#Setup-a-Postgres-repository","title":"Setup a Postgres repository","abstract":[{"text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-a-Postgres-repository"},"todos-testing-09.swift":{"syntax":"swift","highlights":[{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":34},{"line":35}],"fileName":"Tests\/AppTests\/AppTests.swift","type":"file","fileType":"swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","final class AppTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 0","        let logLevel: Logger.Level? = .trace","    }","","    struct CreateRequest: Encodable {","        let title: String","        let order: Int?","    }","    func create(title: String, order: Int? = nil, client: some TestClientProtocol) async throws -> Todo {","        let request = CreateRequest(title: title, order: order)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.execute(uri: \"\/todos\", method: .post, body: buffer) { response in","            XCTAssertEqual(response.status, .created)","            return try JSONDecoder().decode(Todo.self, from: response.body)","        }","    }","","    \/\/ MARK: Tests","    ","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            let todo = try await self.create(title: \"My first todo\", client: client)","            XCTAssertEqual(todo.title, \"My first todo\")","        }","    }","}"],"identifier":"todos-testing-09.swift"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Testing-your-application":{"abstract":[],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application","role":"article","kind":"article","title":"Testing your application","type":"topic","url":"\/tutorials\/todos\/testing-your-application"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing#Test-your-application":{"type":"section","kind":"section","role":"pseudoSymbol","url":"\/tutorials\/hummingbird\/todos-3-testing#Test-your-application","title":"Test your application","abstract":[{"text":"Test your application using the HummingbirdTesting framework","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Test-your-application"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Application-setup":{"type":"topic","kind":"article","role":"article","url":"\/tutorials\/todos\/application-setup","title":"Application setup","abstract":[],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Application-setup"},"todos-testing-11.swift":{"fileName":"Tests\/AppTests\/AppTests.swift","highlights":[{"line":9},{"line":10},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27}],"fileType":"swift","type":"file","syntax":"swift","identifier":"todos-testing-11.swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","extension AppTests {","    func testPatch() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            \/\/ create todo","            let todo = try await self.create(title: \"Deliver parcels to James\", client: client)","            \/\/ rename it","            _ = try await self.patch(id: todo.id, title: \"Deliver parcels to Claire\", client: client)","            let editedTodo = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo?.title, \"Deliver parcels to Claire\")","            \/\/ set it to completed","            _ = try await self.patch(id: todo.id, completed: true, client: client)","            let editedTodo2 = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo2?.completed, true)","            \/\/ revert it","            _ = try await self.patch(id: todo.id, title: \"Deliver parcels to James\", completed: false, client: client)","            let editedTodo3 = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo3?.title, \"Deliver parcels to James\")","            XCTAssertEqual(editedTodo3?.completed, false)","        }","    }","}"]},"todos-testing-12.swift":{"syntax":"swift","highlights":[{"line":10},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36}],"fileName":"Tests\/AppTests\/AppTests.swift","type":"file","fileType":"swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","extension AppTests {","    func testAPI() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            \/\/ create two todos","            let todo1 = try await self.create(title: \"Wash my hair\", client: client)","            let todo2 = try await self.create(title: \"Brush my teeth\", client: client)","            \/\/ get first todo","            let getTodo = try await self.get(id: todo1.id, client: client)","            XCTAssertEqual(getTodo, todo1)","            \/\/ patch second todo","            let optionalPatchedTodo = try await self.patch(id: todo2.id, completed: true, client: client)","            let patchedTodo = try XCTUnwrap(optionalPatchedTodo)","            XCTAssertEqual(patchedTodo.completed, true)","            XCTAssertEqual(patchedTodo.title, todo2.title)","            \/\/ get all todos and check first todo and patched second todo are in the list","            let todos = try await self.list(client: client)","            XCTAssertNotNil(todos.firstIndex(of: todo1))","            XCTAssertNotNil(todos.firstIndex(of: patchedTodo))","            \/\/ delete a todo and verify it has been deleted","            let status = try await self.delete(id: todo1.id, client: client)","            XCTAssertEqual(status, .ok)","            let deletedTodo = try await self.get(id: todo1.id, client: client)","            XCTAssertNil(deletedTodo)","            \/\/ delete all todos and verify there are none left","            try await self.deleteAll(client: client)","            let todos2 = try await self.list(client: client)","            XCTAssertEqual(todos2.count, 0)","        }","    }","}"],"identifier":"todos-testing-12.swift"},"hummingbird.png":{"type":"image","alt":"Hummingbird logo","identifier":"hummingbird.png","variants":[{"url":"\/images\/hummingbird.png","traits":["1x","light"]}]},"todos-testing-13.swift":{"fileName":"Tests\/AppTests\/AppTests.swift","highlights":[{"line":10},{"line":11},{"line":12},{"line":13}],"fileType":"swift","type":"file","syntax":"swift","identifier":"todos-testing-13.swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","extension AppTests {","    func testDeletingTodoTwiceReturnsBadRequest() async throws {}","    func testGettingTodoWithInvalidUUIDReturnsBadRequest() async throws {}","    func test30ConcurrentlyCreatedTodosAreAllCreated() async throws {}","    func testUpdatingNonExistentTodoReturnsBadRequest() async throws {}","}"]},"todos-testing-10.swift":{"syntax":"swift","highlights":[{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42},{"line":43},{"line":44},{"line":45},{"line":46},{"line":47},{"line":48},{"line":49},{"line":50},{"line":51},{"line":52},{"line":53},{"line":54},{"line":55},{"line":56},{"line":57},{"line":58},{"line":59},{"line":60},{"line":61},{"line":62},{"line":63},{"line":64},{"line":65},{"line":66},{"line":67},{"line":68},{"line":69},{"line":70},{"line":71},{"line":72},{"line":73},{"line":74},{"line":75},{"line":77}],"fileName":"Tests\/AppTests\/AppTests.swift","type":"file","fileType":"swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","final class AppTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 0","        let logLevel: Logger.Level? = .trace","    }","","    struct CreateRequest: Encodable {","        let title: String","        let order: Int?","    }","    func create(title: String, order: Int? = nil, client: some TestClientProtocol) async throws -> Todo {","        let request = CreateRequest(title: title, order: order)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.execute(uri: \"\/todos\", method: .post, body: buffer) { response in","            XCTAssertEqual(response.status, .created)","            return try JSONDecoder().decode(Todo.self, from: response.body)","        }","    }","","    func get(id: UUID, client: some TestClientProtocol) async throws -> Todo? {","        try await client.execute(uri: \"\/todos\/\\(id)\", method: .get) { response in","            \/\/ either the get request returned an 200 status or it didn't return a Todo","            XCTAssert(response.status == .ok || response.body.readableBytes == 0)","            if response.body.readableBytes > 0 {","                return try JSONDecoder().decode(Todo.self, from: response.body)","            } else {","                return nil","            }","        }","    }","","    func list(client: some TestClientProtocol) async throws -> [Todo] {","        try await client.execute(uri: \"\/todos\", method: .get) { response in","            XCTAssertEqual(response.status, .ok)","            return try JSONDecoder().decode([Todo].self, from: response.body)","        }","    }","","    struct UpdateRequest: Encodable {","        let title: String?","        let order: Int?","        let completed: Bool?","    }","    func patch(id: UUID, title: String? = nil, order: Int? = nil, completed: Bool? = nil, client: some TestClientProtocol) async throws -> Todo? {","        let request = UpdateRequest(title: title, order: order, completed: completed)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.execute(uri: \"\/todos\/\\(id)\", method: .patch, body: buffer) { response in","            XCTAssertEqual(response.status, .ok)","            if response.body.readableBytes > 0 {","                return try JSONDecoder().decode(Todo.self, from: response.body)","            } else {","                return nil","            }","        }","    }","","    func delete(id: UUID, client: some TestClientProtocol) async throws -> HTTPResponse.Status {","        try await client.execute(uri: \"\/todos\/\\(id)\", method: .delete) { response in","            response.status","        }","    }","","    func deleteAll(client: some TestClientProtocol) async throws -> Void {","        try await client.execute(uri: \"\/todos\", method: .delete) { _ in }","    }","","    \/\/ MARK: Tests","","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            let todo = try await self.create(title: \"My first todo\", client: client)","            XCTAssertEqual(todo.title, \"My first todo\")","        }","    }","}"],"identifier":"todos-testing-10.swift"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API#Todo-Controller-and-Repository":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Todo-Controller-and-Repository","abstract":[{"text":"Add some functionality to your application.","type":"text"}],"url":"\/tutorials\/hummingbird\/todos-2-api#Todo-Controller-and-Repository","title":"Todo Controller and Repository","kind":"section","type":"section","role":"pseudoSymbol"},"todos-testing-03.swift":{"fileName":"Sources\/App\/Application+build.swift","highlights":[],"fileType":"swift","type":"file","syntax":"swift","identifier":"todos-testing-03.swift","content":["\/\/\/ Application arguments protocol. ","public protocol AppArguments {","    var hostname: String { get }","    var port: Int { get }","    var logLevel: Logger.Level? { get }","}","","\/\/\/  Build application","\/\/\/ - Parameter arguments: application arguments","public func buildApplication(_ arguments: some AppArguments) async throws -> some ApplicationProtocol {"]},"doc://com.opticalaberration.hummingbird/tutorials/Todos":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos","title":"Build a Todos application.","role":"overview","type":"topic","abstract":[{"type":"text","text":"A tutorial showing you how to build a simple Todos application that allows you to store, access, edit and delete Todos in a database, using Hummingbird and PostgresNIO."}],"url":"\/tutorials\/todos","kind":"overview"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API#Testing-your-application-with-curl":{"abstract":[{"type":"text","text":"Add some functionality to your application."}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Testing-your-application-with-curl","role":"pseudoSymbol","kind":"section","title":"Testing your application with curl","type":"section","url":"\/tutorials\/hummingbird\/todos-2-api#Testing-your-application-with-curl"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-1-Template":{"type":"topic","kind":"project","estimatedTime":"5min","role":"project","url":"\/tutorials\/hummingbird\/todos-1-template","title":"Create a Hummingbird application.","abstract":[{"text":"Create a simple web application using the Hummingbird template.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Template"},"todos-testing-01.swift":{"syntax":"swift","highlights":[],"fileName":"Package.swift","type":"file","fileType":"swift","content":["\/\/ swift-tools-version:5.9","\/\/ The swift-tools-version declares the minimum version of Swift required to build this package.","","import PackageDescription","","let package = Package(","    name: \"Todos\",","    platforms: [.macOS(.v14), .iOS(.v17), .tvOS(.v17)],","    products: [","        .executable(name: \"App\", targets: [\"App\"]),","    ],","    dependencies: [","        .package(url: \"https:\/\/github.com\/hummingbird-project\/hummingbird.git\", from: \"2.0.0\"),","        .package(url: \"https:\/\/github.com\/apple\/swift-argument-parser.git\", from: \"1.3.0\"),","    ],","    targets: [","        .executableTarget(","            name: \"App\",","            dependencies: [","                .product(name: \"ArgumentParser\", package: \"swift-argument-parser\"),","                .product(name: \"Hummingbird\", package: \"hummingbird\"),","            ]","        ),","        .testTarget(","            name: \"AppTests\",","            dependencies: [","                .byName(name: \"App\"),","                .product(name: \"HummingbirdTesting\", package: \"hummingbird\"),","            ]","        ),","    ]",")"],"identifier":"todos-testing-01.swift"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Store-Todos-in-a-database":{"type":"topic","kind":"article","role":"article","url":"\/tutorials\/todos\/store-todos-in-a-database","title":"Store Todos in a database","abstract":[],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Store-Todos-in-a-database"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing#Project-testing-setup":{"abstract":[{"type":"text","text":"Test your application using the HummingbirdTesting framework"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Project-testing-setup","role":"pseudoSymbol","kind":"section","title":"Project testing setup","type":"section","url":"\/tutorials\/hummingbird\/todos-3-testing#Project-testing-setup"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing":{"abstract":[{"type":"text","text":"Test your application using the HummingbirdTesting framework"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing","role":"project","kind":"project","title":"Testing your application","type":"topic","estimatedTime":"15min","url":"\/tutorials\/hummingbird\/todos-3-testing"},"todos-testing-08.swift":{"fileName":"Tests\/AppTests\/AppTests.swift","highlights":[],"fileType":"swift","type":"file","syntax":"swift","identifier":"todos-testing-08.swift","content":["import Foundation","import Hummingbird","import HummingbirdTesting","import Logging","import XCTest","","@testable import App","","final class AppTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 0","        let logLevel: Logger.Level? = .trace","    }","","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            try await client.execute(uri: \"\/todos\", method: .post, body: ByteBuffer(string: #\"{\"title\":\"My first todo\"}\"#)) { response in","                XCTAssertEqual(response.status, .created)","                let todo = try JSONDecoder().decode(Todo.self, from: response.body)","                XCTAssertEqual(todo.title, \"My first todo\")","            }","        }","    }","}"]},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API":{"type":"topic","kind":"project","estimatedTime":"20min","role":"project","url":"\/tutorials\/hummingbird\/todos-2-api","title":"Add your application API","abstract":[{"type":"text","text":"Add some functionality to your application."}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API"}}}