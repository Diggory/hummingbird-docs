{"kind":"project","metadata":{"categoryPathComponent":"Todos","title":"Testing your application","role":"project","category":"Todo backend"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/tutorials\/hummingbird\/todos-3-testing"]}],"hierarchy":{"modules":[{"projects":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup","sections":[{"kind":"task","reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup#Setup-your-project"},{"kind":"task","reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup#Extend-your-Application"}]}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Application-setup"},{"projects":[{"sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Todo-Controller-and-Repository","kind":"task"},{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Testing-your-application-with-curl","kind":"task"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/API-Setup"},{"projects":[{"sections":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Setup-your-project-for-testing","kind":"task"},{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Test-you-application","kind":"task"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing"}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application"},{"projects":[{"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres","sections":[{"kind":"task","reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-your-Postgres-database"},{"kind":"task","reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-a-Postgres-repository"}]}],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Store-Todos-in-a-database"}],"paths":[["doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos","doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/$volume","doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application"]],"reference":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos"},"sections":[{"title":"Testing your application","kind":"hero","chapter":"Testing your application","estimatedTimeInMinutes":15,"backgroundImage":"hummingbird.png","image":"hummingbird.png","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Test your application using the HummingbirdXCT framework"}]}]},{"kind":"tasks","tasks":[{"contentSection":[{"media":"hummingbird.png","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a test target and restructure your project to make it easier to test."}]}],"mediaPosition":"trailing","kind":"contentAndMedia"}],"title":"Setup your project for testing","stepsSection":[{"code":"todos-testing-01.swift","media":null,"caption":[],"content":[{"type":"paragraph","inlineContent":[{"text":"Open Package.swift","type":"text"}]}],"type":"step","runtimePreview":null},{"code":"todos-testing-02.swift","media":null,"caption":[],"content":[{"inlineContent":[{"text":"Add a test target for “TodosTests”","type":"text"}],"type":"paragraph"}],"type":"step","runtimePreview":null},{"code":"todos-testing-03.swift","media":null,"caption":[],"content":[{"inlineContent":[{"text":"Create a Tests folder and add the file TodosTests.swift inside it.","type":"text"}],"type":"paragraph"}],"type":"step","runtimePreview":null},{"code":"todos-testing-04.swift","media":null,"caption":[],"content":[{"inlineContent":[{"text":"Before we can start testing the application we need a function to create the application. Currently it is created inside ","type":"text"},{"type":"codeVoice","code":"Todos.run"},{"text":" and is inaccessible.","type":"text"}],"type":"paragraph"}],"type":"step","runtimePreview":null},{"code":"todos-testing-05.swift","media":null,"caption":[{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"buildApplication"},{"type":"text","text":" function returns "},{"type":"codeVoice","code":"some HBApplicationProtocol"},{"type":"text","text":". This is to avoid having to list all the generic parameters of "},{"type":"codeVoice","code":"HBApplication"},{"type":"text","text":". FYI in this case it is "},{"type":"codeVoice","code":"HBApplication<HBRouterResponder<TodoRequestContext>, HTTP1Channel>"},{"type":"text","text":"."}],"type":"paragraph"}],"content":[{"inlineContent":[{"type":"text","text":"We move the application creation to a global function outside of "},{"code":"Todos","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"}],"type":"step","runtimePreview":null},{"code":"todos-testing-06.swift","media":null,"caption":[{"inlineContent":[{"type":"text","text":"We’ve added a "},{"type":"codeVoice","code":"inMemoryTesting"},{"type":"text","text":" variable to this protocol which we will use in the future."}],"type":"paragraph"}],"content":[{"inlineContent":[{"type":"text","text":"We cannot instantiate "},{"type":"codeVoice","code":"Todos"},{"type":"text","text":" in our tests so need another way to pass arguments to the buildApplication function. We solve this by creating a protocol AppArguments which Todos conforms to. In our tests we can create a separate concrete type that conforms to this."}],"type":"paragraph"}],"type":"step","runtimePreview":null}],"anchor":"Setup-your-project-for-testing"},{"contentSection":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Writing Tests to ensure you application API works.","type":"text"}]}],"kind":"contentAndMedia","mediaPosition":"trailing","media":"hummingbird.png"}],"title":"Test you application","stepsSection":[{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"We are now in a position where we can test our application. We create a concrete type conforming to "},{"code":"AppArguments","type":"codeVoice"},{"type":"text","text":" which we can pass to "},{"code":"buildApplication","type":"codeVoice"},{"type":"text","text":". The start of function to test the create API is here, with its first line creating the todos application."}]}],"code":"todos-testing-07.swift","media":null,"caption":[],"type":"step"},{"runtimePreview":null,"content":[{"inlineContent":[{"type":"text","text":"This is the filled out function. Application testing is done with the function "},{"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/HBApplicationProtocol\/test(_:_:)","isActive":true},{"type":"text","text":". The first parameter indicates what test framework you want to use. Here we are using "},{"type":"codeVoice","code":".router"},{"type":"text","text":" which indicates we send our request directly to the router without a live server process."}],"type":"paragraph"}],"code":"todos-testing-08.swift","media":null,"caption":[{"inlineContent":[{"text":"In the closure passed to ","type":"text"},{"type":"codeVoice","code":"test"},{"text":" you are provided with a client to interact with the current test framework. With this you can send requests and verify the contents of their responses.","type":"text"}],"type":"paragraph"}],"type":"step"},{"runtimePreview":null,"content":[{"inlineContent":[{"text":"Writing the whole XCTExecute line out each time and converting the responses to something readable can become tiresome. So lets break out the create API call to a separate function. You’ll notice in this function we return the decoded Todo from the XCTExecute closure.","type":"text"}],"type":"paragraph"}],"code":"todos-testing-09.swift","media":null,"caption":[{"inlineContent":[{"text":"Now the create test has been simplified to two lines of code. Call create function, test return value.","type":"text"}],"type":"paragraph"}],"type":"step"},{"runtimePreview":null,"content":[{"inlineContent":[{"type":"text","text":"In actual fact lets create helper functions for all the API calls. With these it shoud be a lot easier to write tests"}],"type":"paragraph"}],"code":"todos-testing-10.swift","media":null,"caption":[],"type":"step"},{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"We can now create more complex test functions. This one edits a todo twice and verifies the edits have been stored."}]}],"code":"todos-testing-11.swift","media":null,"caption":[],"type":"step"},{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The following is the equivalent of the list of curl commands we wrote in the previous chapter to test everything was working ok. Its not the most sensible test but it demonstrates how much easier it is test your application using HummingbirdXCT."}]}],"code":"todos-testing-12.swift","media":null,"caption":[],"type":"step"},{"runtimePreview":null,"content":[{"inlineContent":[{"type":"text","text":"Here are some tests that haven’t been written yet. Maybe you could complete them for me."}],"type":"paragraph"}],"code":"todos-testing-13.swift","media":null,"caption":[{"inlineContent":[{"text":"Hint: A couple of these require you to use XCTExecute directly instead of calling the helper functions we wrote at the top.","type":"text"}],"type":"paragraph"}],"type":"step"}],"anchor":"Test-you-application"}]},{"title":"Use PostgresNIO to store your Todos in a Postgres database","kind":"callToAction","abstract":[{"text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO.","type":"text"}],"action":{"isActive":true,"overridingTitleInlineContent":[{"text":"Get started","type":"text"}],"type":"reference","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres","overridingTitle":"Get started"},"featuredEyebrow":"Tutorial"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing"},"schemaVersion":{"patch":0,"minor":3,"major":0},"references":{"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API#Testing-your-application-with-curl":{"title":"Testing your application with curl","kind":"section","type":"section","abstract":[{"type":"text","text":"Add some functionality to your app"}],"role":"pseudoSymbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Testing-your-application-with-curl","url":"\/tutorials\/hummingbird\/todos-2-api#Testing-your-application-with-curl"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/API-Setup":{"title":"API Setup","kind":"article","type":"topic","abstract":[],"role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/API-Setup","url":"\/tutorials\/todos\/api-setup"},"todos-testing-07.swift":{"fileName":"TodosTests.swift","type":"file","syntax":"swift","identifier":"todos-testing-07.swift","highlights":[],"fileType":"swift","content":["@testable import Todos","import Hummingbird","import HummingbirdXCT","import XCTest","","final class TodosTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 8080","        let inMemoryTesting = true","    }","","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","    }","}"]},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Application-setup":{"title":"Application setup","kind":"article","type":"topic","abstract":[],"role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Application-setup","url":"\/tutorials\/todos\/application-setup"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Testing-your-application":{"title":"Testing your application","kind":"article","type":"topic","abstract":[],"role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Testing-your-application","url":"\/tutorials\/todos\/testing-your-application"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres#Setup-a-Postgres-repository":{"title":"Setup a Postgres repository","kind":"section","type":"section","abstract":[{"type":"text","text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO."}],"role":"pseudoSymbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-a-Postgres-repository","url":"\/tutorials\/hummingbird\/todos-4-postgres#Setup-a-Postgres-repository"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing#Setup-your-project-for-testing":{"title":"Setup your project for testing","kind":"section","type":"section","abstract":[{"type":"text","text":"Test your application using the HummingbirdXCT framework"}],"role":"pseudoSymbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Setup-your-project-for-testing","url":"\/tutorials\/hummingbird\/todos-3-testing#Setup-your-project-for-testing"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-1-Setup":{"kind":"project","abstract":[{"type":"text","text":"Create a simple web application."}],"type":"topic","estimatedTime":"5min","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup","title":"Setup a Hummingbird application.","role":"project","url":"\/tutorials\/hummingbird\/todos-1-setup"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API":{"kind":"project","abstract":[{"text":"Add some functionality to your app","type":"text"}],"type":"topic","estimatedTime":"15min","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API","title":"Add your application API","role":"project","url":"\/tutorials\/hummingbird\/todos-2-api"},"todos-testing-11.swift":{"fileName":"TodosTests.swift","type":"file","syntax":"swift","identifier":"todos-testing-11.swift","highlights":[{"line":7},{"line":8},{"line":11},{"line":12},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25}],"fileType":"swift","content":["@testable import Todos","import Foundation","import Hummingbird","import HummingbirdXCT","import XCTest","","extension TodosTests {","    func testPatch() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            \/\/ create todo","            let todo = try await self.create(title: \"Deliver parcels to James\", client: client)","            \/\/ rename it","            _ = try await self.patch(id: todo.id, title: \"Deliver parcels to Claire\", client: client)","            let editedTodo = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo?.title, \"Deliver parcels to Claire\")","            \/\/ set it to completed","            _ = try await self.patch(id: todo.id, completed: true, client: client)","            let editedTodo2 = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo2?.completed, true)","            \/\/ revert it","            _ = try await self.patch(id: todo.id, title: \"Deliver parcels to James\", completed: false, client: client)","            let editedTodo3 = try await self.get(id: todo.id, client: client)","            XCTAssertEqual(editedTodo3?.title, \"Deliver parcels to James\")","            XCTAssertEqual(editedTodo3?.completed, false)","        }","    }","}"]},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-1-Setup#Setup-your-project":{"title":"Setup your project","kind":"section","type":"section","abstract":[{"type":"text","text":"Create a simple web application."}],"role":"pseudoSymbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup#Setup-your-project","url":"\/tutorials\/hummingbird\/todos-1-setup#Setup-your-project"},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird/HBApplicationProtocol/test(_:_:)":{"title":"test(_:_:)","kind":"symbol","type":"topic","abstract":[{"type":"text","text":"Creates a version of "},{"type":"codeVoice","code":"HBApplication"},{"type":"text","text":" that can be used for testing code"}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird\/HBApplicationProtocol\/test(_:_:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"test"},{"kind":"text","text":"<"},{"kind":"genericParameter","text":"Value"},{"kind":"text","text":">("},{"preciseIdentifier":"s:14HummingbirdXCT15XCTTestingSetupV","kind":"typeIdentifier","text":"XCTTestingSetup"},{"kind":"text","text":", ("},{"kind":"keyword","text":"any"},{"kind":"text","text":" "},{"preciseIdentifier":"s:14HummingbirdXCT19HBXCTClientProtocolP","kind":"typeIdentifier","text":"HBXCTClientProtocol"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"preciseIdentifier":"s:11Hummingbird21HBApplicationProtocolP0A3XCTE4testyqd__AD15XCTTestingSetupV_qd__AD011HBXCTClientC0_pYaYbKctYaKlF5ValueL_qd__mfp","kind":"typeIdentifier","text":"Value"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"preciseIdentifier":"s:11Hummingbird21HBApplicationProtocolP0A3XCTE4testyqd__AD15XCTTestingSetupV_qd__AD011HBXCTClientC0_pYaYbKctYaKlF5ValueL_qd__mfp","kind":"typeIdentifier","text":"Value"}],"url":"\/documentation\/hummingbird\/hbapplicationprotocol\/test(_:_:)"},"todos-testing-13.swift":{"fileName":"TodosTests.swift","type":"file","syntax":"swift","identifier":"todos-testing-13.swift","highlights":[{"line":8},{"line":9},{"line":10},{"line":11}],"fileType":"swift","content":["@testable import Todos","import Foundation","import Hummingbird","import HummingbirdXCT","import XCTest","","extension TodosTests {","    func testDeletingTodoTwiceReturnsBadRequest() async throws {}","    func testGettingTodoWithInvalidUUIDReturnsBadRequest() async throws {}","    func test30ConcurrentlyCreatedTodosAreAllCreated() async throws {}","    func testUpdatingNonExistentTodoReturnsBadRequest() async throws {}","}"]},"todos-testing-12.swift":{"fileName":"TodosTests.swift","type":"file","syntax":"swift","identifier":"todos-testing-12.swift","highlights":[{"line":8},{"line":11},{"line":12},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34}],"fileType":"swift","content":["@testable import Todos","import Foundation","import Hummingbird","import HummingbirdXCT","import XCTest","","extension TodosTests {","    func testAPI() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            \/\/ create two todos","            let todo1 = try await self.create(title: \"Wash my hair\", client: client)","            let todo2 = try await self.create(title: \"Brush my teeth\", client: client)","            \/\/ get first todo","            let getTodo = try await self.get(id: todo1.id, client: client)","            XCTAssertEqual(getTodo, todo1)","            \/\/ patch second todo","            let optionalPatchedTodo = try await self.patch(id: todo2.id, completed: true, client: client)","            let patchedTodo = try XCTUnwrap(optionalPatchedTodo)","            XCTAssertEqual(patchedTodo.completed, true)","            XCTAssertEqual(patchedTodo.title, todo2.title)","            \/\/ get all todos and check first todo and patched second todo are in the list","            let todos = try await self.list(client: client)","            XCTAssertNotNil(todos.firstIndex(of: todo1))","            XCTAssertNotNil(todos.firstIndex(of: patchedTodo))","            \/\/ delete a todo and verify it has been deleted","            let status = try await self.delete(id: todo1.id, client: client)","            XCTAssertEqual(status, .ok)","            let deletedTodo = try await self.get(id: todo1.id, client: client)","            XCTAssertNil(deletedTodo)","            \/\/ delete all todos and verify there are none left","            try await self.deleteAll(client: client)","            let todos2 = try await self.list(client: client)","            XCTAssertEqual(todos2.count, 0)","        }","    }","}"]},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres","abstract":[{"type":"text","text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO."}],"type":"topic","url":"\/tutorials\/hummingbird\/todos-4-postgres","estimatedTime":"20min","kind":"project","role":"project","title":"Use PostgresNIO to store your Todos in a Postgres database"},"todos-testing-10.swift":{"fileName":"TodosTests.swift","type":"file","syntax":"swift","identifier":"todos-testing-10.swift","highlights":[{"line":2},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42},{"line":43},{"line":44},{"line":45},{"line":46},{"line":47},{"line":48},{"line":49},{"line":50},{"line":51},{"line":52},{"line":53},{"line":54},{"line":55},{"line":56},{"line":57},{"line":58},{"line":59},{"line":60},{"line":61},{"line":62},{"line":63},{"line":64},{"line":65},{"line":66},{"line":67},{"line":68},{"line":69},{"line":70},{"line":71},{"line":72},{"line":73},{"line":74},{"line":75},{"line":77}],"fileType":"swift","content":["@testable import Todos","import Foundation","import Hummingbird","import HummingbirdXCT","import XCTest","","final class TodosTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 8080","        let inMemoryTesting = true","    }","","    struct CreateRequest: Encodable {","        let title: String","        let order: Int?","    }","    func create(title: String, order: Int? = nil, client: some HBXCTClientProtocol) async throws -> Todo {","        let request = CreateRequest(title: title, order: order)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.XCTExecute(uri: \"\/todos\", method: .post, body: buffer) { response in","            XCTAssertEqual(response.status, .created)","            let body = try XCTUnwrap(response.body)","            return try JSONDecoder().decode(Todo.self, from: body)","        }","    }","","    func get(id: UUID, client: some HBXCTClientProtocol) async throws -> Todo? {","        try await client.XCTExecute(uri: \"\/todos\/\\(id)\", method: .get) { response in","            \/\/ either the get request returned an 200 status or it didn't return a Todo","            XCTAssert(response.status == .ok || response.body == nil || response.body?.readableBytes == 0)","            if let body = response.body, body.readableBytes > 0 {","                return try JSONDecoder().decode(Todo.self, from: body)","            } else {","                return nil","            }","        }","    }","","    func list(client: some HBXCTClientProtocol) async throws -> [Todo] {","        try await client.XCTExecute(uri: \"\/todos\", method: .get) { response in","            XCTAssertEqual(response.status, .ok)","            let body = try XCTUnwrap(response.body)","            return try JSONDecoder().decode([Todo].self, from: body)","        }","    }","","    struct UpdateRequest: Encodable {","        let title: String?","        let order: Int?","        let completed: Bool?","    }","    func patch(id: UUID, title: String? = nil, order: Int? = nil, completed: Bool? = nil, client: some HBXCTClientProtocol) async throws -> Todo? {","        let request = UpdateRequest(title: title, order: order, completed: completed)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.XCTExecute(uri: \"\/todos\/\\(id)\", method: .patch, body: buffer) { response in","            XCTAssertEqual(response.status, .ok)","            if let body = response.body, body.readableBytes > 0 {","                return try JSONDecoder().decode(Todo.self, from: body)","            } else {","                return nil","            }","        }","    }","","    func delete(id: UUID, client: some HBXCTClientProtocol) async throws -> HTTPResponse.Status {","        try await client.XCTExecute(uri: \"\/todos\/\\(id)\", method: .delete) { response in","            response.status","        }","    }","","    func deleteAll(client: some HBXCTClientProtocol) async throws -> Void {","        try await client.XCTExecute(uri: \"\/todos\", method: .delete) { _ in }","    }","","    \/\/ MARK: Tests","","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            let todo = try await self.create(title: \"My first todo\", client: client)","            XCTAssertEqual(todo.title, \"My first todo\")","        }","    }","}"]},"todos-testing-02.swift":{"fileName":"Package.swift","type":"file","syntax":"swift","identifier":"todos-testing-02.swift","highlights":[{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27}],"fileType":"swift","content":["\/\/ swift-tools-version: 5.9","import PackageDescription","","let package = Package(","    name: \"Todos\",","    platforms: [.macOS(.v14)],","    dependencies: [","        .package(url: \"https:\/\/github.com\/apple\/swift-argument-parser.git\", from: \"1.2.0\"),","        .package(url: \"https:\/\/github.com\/hummingbird-project\/hummingbird.git\", branch: \"2.x.x\"),","    ],","    targets: [","        .executableTarget(","            name: \"Todos\",","            dependencies: [","                .product(name: \"ArgumentParser\", package: \"swift-argument-parser\"),","                .product(name: \"Hummingbird\", package: \"hummingbird\"),","                .product(name: \"HummingbirdFoundation\", package: \"hummingbird\"),","            ]","        ),","        .testTarget(","            name: \"TodosTests\",","            dependencies: [","                \"Todos\",","                .product(name: \"Hummingbird\", package: \"hummingbird\"),","                .product(name: \"HummingbirdXCT\", package: \"hummingbird\"),","            ]","        )","    ]",")"]},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-2-API#Todo-Controller-and-Repository":{"title":"Todo Controller and Repository","kind":"section","type":"section","abstract":[{"type":"text","text":"Add some functionality to your app"}],"role":"pseudoSymbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-2-API#Todo-Controller-and-Repository","url":"\/tutorials\/hummingbird\/todos-2-api#Todo-Controller-and-Repository"},"doc://com.opticalaberration.hummingbird/tutorials/Todos/Store-Todos-in-a-database":{"title":"Store Todos in a database","kind":"article","type":"topic","abstract":[],"role":"article","identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos\/Store-Todos-in-a-database","url":"\/tutorials\/todos\/store-todos-in-a-database"},"todos-testing-04.swift":{"highlights":[],"fileName":"Todos.swift","content":["import ArgumentParser","import Hummingbird","","@main","struct Todos: AsyncParsableCommand {","    @Option(name: .shortAndLong)","    var hostname: String = \"127.0.0.1\"","","    @Option(name: .shortAndLong)","    var port: Int = 8080","","    func run() async throws {","        var logger = Logger(label: \"Todos\")","        logger.logLevel = .debug","        \/\/ create router","        let router = HBRouter(context: TodoRequestContext.self)","        \/\/ add logging middleware","        router.middlewares.add(HBLogRequestsMiddleware(.info))","        \/\/ add hello route","        router.get(\"\/\") { request, context in","            \"Hello\\n\"","        }","        \/\/ add Todos API","        TodoController(repository: TodoMemoryRepository()).addRoutes(to: router.group(\"todos\"))","        \/\/ create application","        let app = HBApplication(","            router: router,","            configuration: .init(address: .hostname(self.hostname, port: self.port)),","            logger: logger","        )","        \/\/ run application","        try await app.runService()","    }","}"],"identifier":"todos-testing-04.swift","type":"file","fileType":"swift","syntax":"swift"},"todos-testing-08.swift":{"highlights":[{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22}],"fileName":"TodosTests.swift","content":["@testable import Todos","import Hummingbird","import HummingbirdXCT","import XCTest","","final class TodosTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 8080","        let inMemoryTesting = true","    }","","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            try await client.XCTExecute(uri: \"\/todos\", method: .post, body: ByteBuffer(string: #\"{\"title\":\"My first todo\"}\"#)) { response in","                XCTAssertEqual(response.status, .created)","                let body = try XCTUnwrap(response.body)","                let todo = try JSONDecoder().decode(Todo.self, from: body)","                XCTAssertEqual(todo.title, \"My first todo\")","            }","        }","    }","}"],"identifier":"todos-testing-08.swift","type":"file","fileType":"swift","syntax":"swift"},"todos-testing-05.swift":{"highlights":[{"line":14},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42}],"fileName":"Todos.swift","content":["import ArgumentParser","import Hummingbird","","@main","struct Todos: AsyncParsableCommand {","    @Option(name: .shortAndLong)","    var hostname: String = \"127.0.0.1\"","","    @Option(name: .shortAndLong)","    var port: Int = 8080","","    func run() async throws {","        \/\/ create application","        let app = try await buildApplication(self)","        \/\/ run application","        try await app.runService()","    }","}","","\/\/\/ Build a HBApplication","func buildApplication(_ args: Todos) async throws -> some HBApplicationProtocol {","    var logger = Logger(label: \"Todos\")","    logger.logLevel = .debug","    \/\/ create router","    let router = HBRouter(context: TodoRequestContext.self)","    \/\/ add logging middleware","    router.middlewares.add(HBLogRequestsMiddleware(.info))","    \/\/ add hello route","    router.get(\"\/\") { request, context in","        \"Hello\\n\"","    }","    \/\/ add Todos API","    TodoController(repository: TodoMemoryRepository()).addRoutes(to: router.group(\"todos\"))","    \/\/ create application","    let app = HBApplication(","        router: router,","        configuration: .init(address: .hostname(args.hostname, port: args.port)),","        logger: logger","    )","    return app","}",""],"identifier":"todos-testing-05.swift","type":"file","fileType":"swift","syntax":"swift"},"todos-testing-01.swift":{"highlights":[],"fileName":"Package.swift","content":["\/\/ swift-tools-version: 5.9","import PackageDescription","","let package = Package(","    name: \"Todos\",","    platforms: [.macOS(.v14)],","    dependencies: [","        .package(url: \"https:\/\/github.com\/apple\/swift-argument-parser.git\", from: \"1.2.0\"),","        .package(url: \"https:\/\/github.com\/hummingbird-project\/hummingbird.git\", branch: \"2.x.x\"),","    ],","    targets: [","        .executableTarget(","            name: \"Todos\",","            dependencies: [","                .product(name: \"ArgumentParser\", package: \"swift-argument-parser\"),","                .product(name: \"Hummingbird\", package: \"hummingbird\"),","                .product(name: \"HummingbirdFoundation\", package: \"hummingbird\"),","            ]","        ),","    ]",")"],"identifier":"todos-testing-01.swift","type":"file","fileType":"swift","syntax":"swift"},"hummingbird.png":{"variants":[{"url":"\/images\/hummingbird.png","traits":["1x","light"]}],"identifier":"hummingbird.png","type":"image","alt":"Hummingbird logo"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing","abstract":[{"type":"text","text":"Test your application using the HummingbirdXCT framework"}],"type":"topic","url":"\/tutorials\/hummingbird\/todos-3-testing","estimatedTime":"15min","kind":"project","role":"project","title":"Testing your application"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-1-Setup#Extend-your-Application":{"title":"Extend your Application","kind":"section","abstract":[{"text":"Create a simple web application.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-1-Setup#Extend-your-Application","type":"section","url":"\/tutorials\/hummingbird\/todos-1-setup#Extend-your-Application","role":"pseudoSymbol"},"doc://com.opticalaberration.hummingbird/tutorials/Todos":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Todos","abstract":[{"type":"text","text":"This is a tutorial showing you how to build a simple Todos application that allows you to store, access, edit and delete Todos in a database, using Hummingbird and PostgresNIO."}],"type":"topic","url":"\/tutorials\/todos","kind":"overview","role":"overview","title":"Build a Todos application."},"todos-testing-06.swift":{"highlights":[{"line":5},{"line":12},{"line":13},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":30}],"fileName":"Todos.swift","content":["import ArgumentParser","import Hummingbird","","@main","struct Todos: AsyncParsableCommand, AppArguments {","    @Option(name: .shortAndLong)","    var hostname: String = \"127.0.0.1\"","","    @Option(name: .shortAndLong)","    var port: Int = 8080","","    var inMemoryTesting: Bool { false }","","    func run() async throws {","        \/\/ create application","        let app = try await buildApplication(self)","        \/\/ run application","        try await app.runService()","    }","}","","\/\/\/ Arguments extracted from commandline","protocol AppArguments {","    var hostname: String { get}","    var port: Int { get }","    var inMemoryTesting: Bool { get }","}","","\/\/\/ Build a HBApplication","func buildApplication(_ args: some AppArguments) async throws -> some HBApplicationProtocol {","    var logger = Logger(label: \"Todos\")","    logger.logLevel = .debug","    \/\/ create router","    let router = HBRouter(context: TodoRequestContext.self)","    \/\/ add logging middleware","    router.middlewares.add(HBLogRequestsMiddleware(.info))","    \/\/ add hello route","    router.get(\"\/\") { request, context in","        \"Hello\\n\"","    }","    \/\/ add Todos API","    TodoController(repository: TodoMemoryRepository()).addRoutes(to: router.group(\"todos\"))","    \/\/ create application","    let app = HBApplication(","        router: router,","        configuration: .init(address: .hostname(args.hostname, port: args.port)),","        logger: logger","    )","    return app","}"],"identifier":"todos-testing-06.swift","type":"file","fileType":"swift","syntax":"swift"},"todos-testing-03.swift":{"highlights":[],"fileName":"TodosTests.swift","content":["@testable import Todos","import XCTest","","final class TodosTests: XCTestCase {","}"],"identifier":"todos-testing-03.swift","type":"file","fileType":"swift","syntax":"swift"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-4-Postgres#Setup-your-Postgres-database":{"title":"Setup your Postgres database","kind":"section","abstract":[{"text":"Now we have a working API and a way to test it, lets look into storing our todos in a Postgres database with PostgresNIO.","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-4-Postgres#Setup-your-Postgres-database","type":"section","url":"\/tutorials\/hummingbird\/todos-4-postgres#Setup-your-Postgres-database","role":"pseudoSymbol"},"todos-testing-09.swift":{"highlights":[{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":32},{"line":33}],"fileName":"TodosTests.swift","content":["@testable import Todos","import Hummingbird","import HummingbirdXCT","import XCTest","","final class TodosTests: XCTestCase {","    struct TestArguments: AppArguments {","        let hostname = \"127.0.0.1\"","        let port = 8080","        let inMemoryTesting = true","    }","","    struct CreateRequest: Encodable {","        let title: String","        let order: Int?","    }","    func create(title: String, order: Int? = nil, client: some HBXCTClientProtocol) async throws -> Todo {","        let request = CreateRequest(title: title, order: order)","        let buffer = try JSONEncoder().encodeAsByteBuffer(request, allocator: ByteBufferAllocator())","        return try await client.XCTExecute(uri: \"\/todos\", method: .post, body: buffer) { response in","            XCTAssertEqual(response.status, .created)","            let body = try XCTUnwrap(response.body)","            return try JSONDecoder().decode(Todo.self, from: body)","        }","    }","","    \/\/ MARK: Tests","    ","    func testCreate() async throws {","        let app = try await buildApplication(TestArguments())","        try await app.test(.router) { client in","            let todo = try await self.create(title: \"My first todo\", client: client)","            XCTAssertEqual(todo.title, \"My first todo\")","        }","    }","}"],"identifier":"todos-testing-09.swift","type":"file","fileType":"swift","syntax":"swift"},"doc://com.opticalaberration.hummingbird/tutorials/Hummingbird/Todos-3-Testing#Test-you-application":{"title":"Test you application","kind":"section","abstract":[{"text":"Test your application using the HummingbirdXCT framework","type":"text"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/tutorials\/Hummingbird\/Todos-3-Testing#Test-you-application","type":"section","url":"\/tutorials\/hummingbird\/todos-3-testing#Test-you-application","role":"pseudoSymbol"}}}