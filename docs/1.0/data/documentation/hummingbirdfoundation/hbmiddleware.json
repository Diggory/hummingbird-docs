{"relationshipsSections":[{"type":"inheritedBy","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAsyncAuthenticator","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBAsyncMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAsyncSessionAuthenticator","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAuthenticator","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBSessionAuthenticator"],"kind":"relationships","title":"Inherited By"},{"type":"conformingTypes","identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBCORSMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBFileMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBLogRequestsMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMetricsMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBTracingMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/IsAuthenticatedMiddleware"],"kind":"relationships","title":"Conforming Types"}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/hummingbirdfoundation\/hbmiddleware"]}],"schemaVersion":{"patch":0,"major":0,"minor":3},"sections":[],"metadata":{"roleHeading":"Protocol","role":"symbol","modules":[{"name":"HummingbirdFoundation"}],"externalID":"s:11Hummingbird12HBMiddlewareP","navigatorTitle":[{"kind":"identifier","text":"HBMiddleware"}],"fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBMiddleware"}],"symbolKind":"protocol","title":"HBMiddleware"},"primaryContentSections":[{"declarations":[{"tokens":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBMiddleware","kind":"identifier"}],"languages":["swift"],"platforms":["Linux"]}],"kind":"declarations"},{"content":[{"anchor":"Overview","type":"heading","level":2,"text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Middleware can be used to edit requests before they are forwared to the router, edit the responses returned by the route handlers or even shortcut the router and return their own responses. Middleware is added to the application as follows."}]},{"type":"codeListing","code":["let app = HBApplication()","app.middleware.add(MyMiddlware())"],"syntax":"swift"},{"anchor":"Groups","type":"heading","level":3,"text":"Groups"},{"type":"paragraph","inlineContent":[{"text":"Middleware can also be applied to a specific set of routes using groups. Below is a example of applying an authentication middleware ","type":"text"},{"code":"BasicAuthenticatorMiddleware","type":"codeVoice"},{"text":" to routes that need protected.","type":"text"}]},{"type":"codeListing","code":["let app = HBApplication()","app.router.put(\"\/user\", createUser)","app.router.group()","    .add(middleware: BasicAuthenticatorMiddleware())","    .post(\"\/user\", loginUser)"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The first route that calls "},{"type":"codeVoice","code":"createUser"},{"type":"text","text":" does not have the "},{"type":"codeVoice","code":"BasicAuthenticatorMiddleware"},{"type":"text","text":" applied to it. But the route calling "},{"type":"codeVoice","code":"loginUser"},{"type":"text","text":" which is inside the group does have the middleware applied."}]},{"anchor":"Writing-Middleware","type":"heading","level":3,"text":"Writing Middleware"},{"type":"paragraph","inlineContent":[{"type":"text","text":"All middleware has to conform to the protocol "},{"type":"codeVoice","code":"HBMiddleware"},{"type":"text","text":". This requires one function "},{"type":"codeVoice","code":"apply(to:next)"},{"type":"text","text":" to be implemented. At some point in this function unless you want to shortcut the router and return your own response you are required to call "},{"type":"codeVoice","code":"next.respond(to: request)"},{"type":"text","text":" and return the result, or a result processed by your middleware. The following is a simple logging middleware that outputs every URI being sent to the server"}]},{"type":"codeListing","code":["public struct LogRequestsMiddleware: HBMiddleware {","    public func apply(to request: HBRequest, next: HBResponder) -> EventLoopFuture<HBResponse> {","        \/\/ log request URI","        request.logger.log(level: .debug, String(describing:request.uri.path))","        \/\/ pass request onto next middleware or the router","        return next.respond(to: request)","    }","}"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to process the response after it has been returned by the route handler you will need to use run a function on the "},{"code":"EventLoopFuture","type":"codeVoice"},{"type":"text","text":" returned by "},{"code":"next.respond","type":"codeVoice"},{"type":"text","text":". Swift NIO provide documentation "},{"code":"EventLoopFuture","type":"codeVoice"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/apple.github.io\/swift-nio\/docs\/current\/NIO\/Classes\/EventLoopFuture.html","isActive":true},{"type":"text","text":"."}]},{"type":"codeListing","code":["public struct ResponseProcessingMiddleware: HBMiddleware {","    public func apply(to request: HBRequest, next: HBResponder) -> EventLoopFuture<HBResponse> {","        return next.respond(to: request).map { response in","            \/\/ process responses from handler and middleware further down the chain","            return processResponse(response)","        }","        .flatMapError { error in","            \/\/ if an error is thrown by handler or middleware further down the ","            \/\/ chain process that","            return processError(error)","        }","    }","}"],"syntax":"swift"}],"kind":"content"}],"abstract":[{"type":"text","text":"Processing requests and responses outside of request handlers."}],"topicSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddleware\/apply(to:next:)-ixu0"],"title":"Instance Methods"}],"seeAlsoSections":[{"identifiers":["doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBAsyncMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddlewareGroup","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBCORSMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBLogRequestsMiddleware","doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMetricsMiddleware"],"title":"Middleware","generated":true}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddleware"},"kind":"symbol","hierarchy":{"paths":[["doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird"]]},"references":{"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBTracingMiddleware":{"url":"\/documentation\/hummingbirdfoundation\/hbtracingmiddleware","abstract":[{"text":"Middleware creating Distributed Tracing spans for each request.","type":"text"}],"navigatorTitle":[{"text":"HBTracingMiddleware","kind":"identifier"}],"title":"HBTracingMiddleware","type":"topic","kind":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBTracingMiddleware","role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBTracingMiddleware","kind":"identifier"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/IsAuthenticatedMiddleware":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/IsAuthenticatedMiddleware","abstract":[{"type":"text","text":"Middleware returning 404 for unauthenticated requests"}],"navigatorTitle":[{"kind":"identifier","text":"IsAuthenticatedMiddleware"}],"url":"\/documentation\/hummingbirdauth\/isauthenticatedmiddleware","role":"symbol","type":"topic","kind":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"IsAuthenticatedMiddleware"}],"title":"IsAuthenticatedMiddleware"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/HBAuthenticator":{"title":"HBAuthenticator","type":"topic","url":"\/documentation\/hummingbirdauth\/hbauthenticator","role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAuthenticator","kind":"symbol","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"text":"HBAuthenticator","kind":"identifier"}],"navigatorTitle":[{"kind":"identifier","text":"HBAuthenticator"}],"abstract":[{"type":"text","text":"Middleware to check if a request is authenticated and then augment the request with"},{"type":"text","text":" "},{"text":"authentication data.","type":"text"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/HBAsyncSessionAuthenticator":{"fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"HBAsyncSessionAuthenticator"}],"kind":"symbol","type":"topic","title":"HBAsyncSessionAuthenticator","url":"\/documentation\/hummingbirdauth\/hbasyncsessionauthenticator","abstract":[{"type":"text","text":"Async version of session authenticator."}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAsyncSessionAuthenticator","navigatorTitle":[{"kind":"identifier","text":"HBAsyncSessionAuthenticator"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBMiddleware/apply(to:next:)-ixu0":{"abstract":[],"defaultImplementations":3,"kind":"symbol","required":true,"fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"apply"},{"kind":"text","text":"("},{"kind":"externalParam","text":"to"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"HBRequest","preciseIdentifier":"s:11Hummingbird9HBRequestV"},{"kind":"text","text":", "},{"kind":"externalParam","text":"next"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"HBResponder","preciseIdentifier":"s:11Hummingbird11HBResponderP"},{"kind":"text","text":") -> "},{"kind":"typeIdentifier","text":"EventLoopFuture","preciseIdentifier":"s:7NIOCore15EventLoopFutureC"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"HBResponse","preciseIdentifier":"s:11Hummingbird10HBResponseV"},{"text":">","kind":"text"}],"title":"apply(to:next:)","type":"topic","role":"symbol","url":"\/documentation\/hummingbirdfoundation\/hbmiddleware\/apply(to:next:)-ixu0","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddleware\/apply(to:next:)-ixu0"},"https://apple.github.io/swift-nio/docs/current/NIO/Classes/EventLoopFuture.html":{"title":"here","type":"link","titleInlineContent":[{"text":"here","type":"text"}],"identifier":"https:\/\/apple.github.io\/swift-nio\/docs\/current\/NIO\/Classes\/EventLoopFuture.html","url":"https:\/\/apple.github.io\/swift-nio\/docs\/current\/NIO\/Classes\/EventLoopFuture.html"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/HBAsyncAuthenticator":{"role":"symbol","fragments":[{"kind":"keyword","text":"protocol"},{"text":" ","kind":"text"},{"kind":"identifier","text":"HBAsyncAuthenticator"}],"url":"\/documentation\/hummingbirdauth\/hbasyncauthenticator","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBAsyncAuthenticator","abstract":[{"text":"Async version of Middleware to check if a request is authenticated and then augment the request with","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"authentication data."}],"title":"HBAsyncAuthenticator","navigatorTitle":[{"kind":"identifier","text":"HBAsyncAuthenticator"}],"kind":"symbol","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBMiddleware":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddleware","navigatorTitle":[{"text":"HBMiddleware","kind":"identifier"}],"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBMiddleware","kind":"identifier"}],"title":"HBMiddleware","type":"topic","role":"symbol","kind":"symbol","abstract":[{"type":"text","text":"Processing requests and responses outside of request handlers."}],"url":"\/documentation\/hummingbirdfoundation\/hbmiddleware"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBMetricsMiddleware":{"role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBMetricsMiddleware","kind":"identifier"}],"url":"\/documentation\/hummingbirdfoundation\/hbmetricsmiddleware","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMetricsMiddleware","abstract":[{"text":"Middleware recording metrics for each request","type":"text"}],"title":"HBMetricsMiddleware","navigatorTitle":[{"text":"HBMetricsMiddleware","kind":"identifier"}],"kind":"symbol","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBLogRequestsMiddleware":{"role":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"HBLogRequestsMiddleware"}],"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBLogRequestsMiddleware","navigatorTitle":[{"kind":"identifier","text":"HBLogRequestsMiddleware"}],"abstract":[{"type":"text","text":"Middleware outputting to log for every call to server"}],"type":"topic","title":"HBLogRequestsMiddleware","kind":"symbol","url":"\/documentation\/hummingbirdfoundation\/hblogrequestsmiddleware"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBCORSMiddleware":{"navigatorTitle":[{"text":"HBCORSMiddleware","kind":"identifier"}],"role":"symbol","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBCORSMiddleware","title":"HBCORSMiddleware","type":"topic","url":"\/documentation\/hummingbirdfoundation\/hbcorsmiddleware","kind":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"HBCORSMiddleware","kind":"identifier"}],"abstract":[{"type":"text","text":"Middleware implementing Cross-Origin Resource Sharing (CORS) headers."}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBMiddlewareGroup":{"url":"\/documentation\/hummingbirdfoundation\/hbmiddlewaregroup","role":"symbol","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBMiddlewareGroup","title":"HBMiddlewareGroup","navigatorTitle":[{"text":"HBMiddlewareGroup","kind":"identifier"}],"abstract":[{"text":"Group of middleware that can be used to create a responder chain. Each middleware calls the next one","type":"text"}],"kind":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBMiddlewareGroup","kind":"identifier"}]},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdAuth/HBSessionAuthenticator":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdAuth\/HBSessionAuthenticator","kind":"symbol","role":"symbol","type":"topic","title":"HBSessionAuthenticator","url":"\/documentation\/hummingbirdauth\/hbsessionauthenticator","navigatorTitle":[{"text":"HBSessionAuthenticator","kind":"identifier"}],"abstract":[{"text":"Session authenticator","type":"text"}],"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBSessionAuthenticator","kind":"identifier"}]},"doc://com.opticalaberration.hummingbird/documentation/Hummingbird":{"identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/Hummingbird","title":"Hummingbird","type":"topic","role":"collection","kind":"symbol","abstract":[{"text":"Lightweight, flexible server framework written in Swift.","type":"text"}],"url":"\/documentation\/hummingbird"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBAsyncMiddleware":{"role":"symbol","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBAsyncMiddleware","kind":"identifier"}],"url":"\/documentation\/hummingbirdfoundation\/hbasyncmiddleware","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBAsyncMiddleware","abstract":[{"text":"Middleware using async\/await","type":"text"}],"title":"HBAsyncMiddleware","navigatorTitle":[{"text":"HBAsyncMiddleware","kind":"identifier"}],"kind":"symbol","type":"topic"},"doc://com.opticalaberration.hummingbird/documentation/HummingbirdFoundation/HBFileMiddleware":{"url":"\/documentation\/hummingbirdfoundation\/hbfilemiddleware","role":"symbol","type":"topic","identifier":"doc:\/\/com.opticalaberration.hummingbird\/documentation\/HummingbirdFoundation\/HBFileMiddleware","title":"HBFileMiddleware","navigatorTitle":[{"text":"HBFileMiddleware","kind":"identifier"}],"abstract":[{"text":"Middleware for serving static files.","type":"text"}],"kind":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"HBFileMiddleware","kind":"identifier"}]}}}